# TableCat 今日需求面板（2026-02-28）

## 目标
将屏幕感知从“截图直通模型”升级为“多级门控 + ROI + 评分 + 触发队列”的低打扰方案，并形成可直接指导实现的文档和任务清单。

## 今日已完成
- [x] 新增总体设计文档：`docs/design/design.md`
- [x] 新增总体技术文档：`docs/tech/tech-design.md`
- [x] 新增多级门控专项文档：`docs/tech/multilevel-gating.md`
- [x] 新增触发机制专项文档：`docs/tech/trigger-mechanism.md`
- [x] 屏幕门控骨架接入：`attentionLoop + L0/L1 + ROI + TriggerQueue`
- [x] 多图送模接入：当前 ROI + 历史 ROI + 全局图
- [x] Debug 评分牌接入
- [x] Session 级日志与门控目录落盘接入

## P0
1. 屏幕门控主链路
- 保持 `ScreenAttentionLoop` 独立运行
- 继续收敛 `L0/L1` 默认阈值
- 确保门控链路在无 LLM 时也可独立观察和调试

2. ROI 与评分
- 保持 `8x8` 网格 ROI 提案
- 继续调优 `visualDelta / hashDistance / clusterScore`
- 以 `finalScore` 为最终触发依据

3. 多图送模与兼容回退
- 保持当前 `attachments` 方案
- ROI 失败时回退全局图
- 非 JSON 或失败时不阻断主流程

## P1
4. 设置与调参
- 继续完善设置面板中文文案
- 保持 `screen_gate_tick_ms`、`screen_global_cooldown_sec` 等参数可在线调节
- 明确“检测频率”和“AI 提交频率”是两层配置

5. 调试与观测
- 保持 `LOG/screenshots/<session>/`
- 保持 `LOG/screen-attention/<session>/`
- 保持 `LOG/sessions/<session>.log`
- 增强为什么触发/为什么不触发的可解释性

## P2
6. 主动陪伴与更强新鲜度
- 当前主动陪伴保留最小可用实现
- 后续再收敛触发频率和体验
- 新鲜度后续可考虑升级到更稳定的签名或 embedding

## 当前关键参数
- `perception_interval_sec`
  - 旧通道轮询间隔
  - 最低 `1s`
- `screen_gate_tick_ms`
  - 屏幕门控检测间隔
  - 最低 `100ms`
- `screen_global_cooldown_sec`
  - 屏幕 AI 最短提交间隔
  - 最低 `1s`

## 相关文档
- `docs/design/design.md`
- `docs/tech/tech-design.md`
- `docs/tech/multilevel-gating.md`
- `docs/tech/trigger-mechanism.md`
- `docs/tech/interface-protocols.md`
