# TableCat 今日需求（2026-02-28）

## 目标
今天把项目的屏幕感知方案从“截图直通大模型”推进到“多级门控 + ROI + 评分 + 触发队列”的低打扰专项设计状态，并形成可直接指导实现的技术文档与计划清单。

## 需求清单（按优先级）
1. 屏幕门控骨架（P0）
- 新增 `attentionLoop` 设计。
- 新增 L0 / L1 判定结果结构设计。
- 新增事件日志落盘设计。
验收标准：门控链路的专项技术方案清晰，能独立于 LLM 主链路解释其输入、输出与职责边界。

2. ROI 提案与触发评分（P0）
- 明确网格化 ROI 策略。
- 明确 `Excitement / Interrupt / Novelty / finalScore` 评分定义。
- 明确冷却与去重缓存策略。
验收标准：实现方无需再决定 ROI 数量、覆盖率上限、评分字段与默认阈值。

3. 多图送模与兼容回退（P0）
- 明确当前 ROI、历史 ROI、全局缩略图三图输入策略。
- 明确 `ScreenAttentionPacket` 与多模态编排关系。
- 明确失败时退回全屏直通的回退方案。
验收标准：实现方可直接按文档接线，不需二次定义送模数据结构。

4. 设置面板与配置持久化（P1）
- 明确新增配置项。
- 明确与现有 `enable_perception_loop` / `perception_interval_sec` 的兼容关系。
- 明确门控配置未来在设置面板中的落点。
验收标准：实现方可直接扩展 `app.config.json`、设置 UI 与 IPC，而无需再讨论字段命名。

5. 观测与调试能力（P1）
- 明确 `LOG/screen-attention/<session-id>/` 目录结构。
- 明确候选事件 JSON 字段。
- 明确门控统计项与调试能力。
验收标准：实现方可直接落地门控调试目录与事件记录格式。

6. 主动陪伴模式（P2）
- 明确长稳态主动评论的目标与约束。
- 明确优先级与冷却策略。
验收标准：后续扩展时可以直接按专项文档继续实现，不需重写方案。

## 今日执行记录
- [x] 创建多级门控专项技术设计文档：`docs/tech-design.multilevel-gating.md`
- [x] 创建今日计划文档：`docs/requirements/2026-02-28.md`
- [x] 固定专项文档章节结构：背景、差距、架构、门控、ROI、评分、送模、调试、风险、验收
- [x] 固定 Phase 1 默认策略：CPU-first、屏幕专项先行、评分首版采用加权和
- [x] 固定默认阈值与配置项命名
- [x] 固定调试目录结构与事件 JSON 结构

## 后续实施建议
1. 先实现 `attentionLoop + L0/L1 + 事件日志`，暂不接 LLM。
2. 再实现 ROI 与评分，并用调试目录验证通过率与误触发率。
3. 最后接多图送模与回退链路，避免一开始就把门控问题和模型问题耦合到一起。
